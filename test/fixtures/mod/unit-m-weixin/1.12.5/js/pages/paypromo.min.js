define("unit-m-weixin@1.12.5/js/modules/paypromo/content/controller",["backbone@~1.1.0","underscore@~1.5.0","wepp@~2.7.0","../../../util/cache","zepto-wepp@~1.1.0","cookie@~0.1.0","./template.html"],function(e,t,o){var n=e("backbone"),i=(e("underscore"),e("wepp")),c=e("../../../util/cache"),r=e("zepto-wepp"),a=i.Module.City,s=e("cookie"),l=i.UI;o.exports=i.Module.BaseController.extend({initModel:function(){var e=c.get("CounponListCache")||{discountList:[]};e.discountList.forEach(function(e){var t=new Date(e.expiredDate);e.expiredDate=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()});var t=new(n.Model.extend())(e);return t.fetch=function(){setTimeout(function(){t.set({r:Math.random()})},0)},this.result={couponType:"",discountId:"",discount:""},t},initTpl:function(){return e("./template.html")},onRender:function(){var e=this.view.$el,t=this;e.find(".J_list .item").on("click",function(){e.find("input[type=radio]").removeAttr("checked");var o=r(this).find("input[type=radio]").attr("checked","true");if(0===r(this).find(".promo-code").length){var n=t.model.get("discountList").filter(function(e){return e.id==o.val()});t.result=n&&n.length?{couponType:"coupon",discountId:n[0].id,discount:n[0].priceStr}:{couponType:"",discountId:"",discount:""}}}),e.find(".J_submit").on("click",function(){t._checkCode()&&(ThisApp.execute("promo::update",t.result),history.go(-1))})},_checkCode:function(){var e=this,t=e.model,o=this.view.$el,n=!0,i=o.find(".promo-code");if(o.find(".code-select").attr("checked")){var c=i.val().trim();if(!c)return l.alert("代码不能为空"),!1;var d=parseInt(s("promoNum"))||0;if(d>10)return l.alert("操作频繁，请20分后再试。"),!1;r.ajax({url:"/ajax/tuan/verifyCouponCodegn.json",data:{groupid:t.get("dealGroupId"),dealid:t.get("dealId"),count:t.get("count"),cityid:a.getId(),code:c},type:"GET",async:!1,dataType:"json",success:function(t){if(200==t.code)e.result.discountId=t.data.id,e.result.discount=t.data.priceStr,e.result.discountType="code";else{var o=t.data;n=!1,l.alert(o.content)}}}),d?s("promoNum",parseInt(d)+1):s("promoNum",1,{expires:1/72})}return n}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.5/js/modules/paypromo/content/template.html",[],function(e,t,o){o.exports='<p class="c-box-tit">选择您要使用的优惠，无效抵用券将不会显示</p><div class="c-box promo-list J_list"><div class="item">不使用优惠<input type="radio" name=\'promo\' checked></div><%_.each(discountList,function(item){%><div class="item J_promo"><p><%= item.title %></p><p><%= item.expiredDate %>&nbsp;&nbsp;过期</p><input type="radio" name=\'promo\' value="<%=item.id%>"></div><%});%><div class="item"><input class="promo-code" type="text" placeholder="填写优惠代码"><input class=\'code-select\' type="radio" name=\'promo\' value="coupon"></div></div><a href="javascript:;" class="y-btn J_submit"  style="width:90%">确认</a><a href="javascript:;" class="y-btn J_submiting hide"  style="width:90%">正在处理</a><div class="height-box"></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.5/js/util/cache",[],function(e,t,o){function n(e){return e in c?c[e]:null}function i(e){return r?JSON.parse(localStorage.getItem(e)):null}var c={},r="localStorage"in window&&null!==window.localStorage,a={has:function(e){return e in c||r&&null!==localStorage.getItem(e)},get:function(e){return null!==n(e)?n(e):i(e)},set:function(e,t){c[e]=t,r&&localStorage.setItem(e,JSON.stringify(t))},remove:function(e){delete c[e],r&&localStorage.removeItem(e)}};o.exports=a},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.5/js/pages/paypromo",["zepto-wepp@~1.1.0","underscore@~1.5.0","wepp@~2.7.0","../modules/paypromo/content/controller"],function(e,t){var o=(e("zepto-wepp"),e("underscore")),n=e("wepp"),i=e("../modules/paypromo/content/controller");t.Controller=n.PageController.extend({show:function(){ThisApp.openPage().then(function(e){e.initRegion({template:o.template('<div class="J_cnt"></div>'),regions:{content:".J_cnt"}}),(new i).render(e.layout.content)})}})},{asyncDeps:["iscroll@~5.0.9"]});
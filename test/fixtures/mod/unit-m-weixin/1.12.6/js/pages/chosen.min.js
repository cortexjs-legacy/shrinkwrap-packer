define("unit-m-weixin@1.12.6/js/modules/common/alert/template.html",[],function(e,t,i){i.exports='<div class="overlay"></div><div class="confirm_alert"><div class="alert_content"><%=content%></div><div class="alert_buttons"><%buttons.forEach(function(btn){%><a href="<%=(btn.url||\'javascript:;\')%>"><%=btn.text%></a><%});%></div></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/common/search/controller",["marionette@~1.4.0","wepp@~2.7.0","./template.html","zepto-wepp@~1.1.0","underscore@~1.5.0","backbone@~1.1.0"],function(e,t,i){function o(){var e=h.getName()||"";return e.length>3?e.substr(0,2)+"..":e}var n=e("marionette"),s=e("wepp").Module,c=s.BaseView(e("./template.html")),r=e("zepto-wepp"),a=e("underscore"),l=e("backbone"),h=s.City,d=n.Controller.extend({initialize:function(e){var t={showCity:!0,showBack:!1};this.options=a.extend(t,e||{}),this.view=new c({model:new l.Model({history:d.History.get(),cityname:o(),showCity:this.options.showCity,showBack:this.options.showBack})})},show:function(e,t){e.show(this.view);var i=this.view.$el;this.searchBox=i.find(".J_search_box"),this.cancelBtn=i.find(".J_cancel"),this.backBtn=i.find(".J_back"),this.historyHolder=i.find(".J_history"),this.historyList=i.find(".J_history ul"),this.clearBtn=i.find(".J_history .clear"),this.cityBox=i.find(".city"),this.trigger("show"),t&&this.setKeywords(t),this.bindEvents()},search:function(e){d.History.add(e),this.searchBox.val(e),this.trigger("search",e)},cancel:function(){var e=this;this.searchBox.parent().removeClass("float"),this.cityBox.removeClass("float"),this.searchBox.get(0).blur(),this.backBtn.show().addClass("on"),this.cancelBtn.hide(),setTimeout(function(){e.historyHolder.hide()},400),this.trigger("blur")},setKeywords:function(e){this.view.$el.find(".J_search_box").val(e)},bindEvents:function(){var e=this,t=this.view.$el;t.find("form").on("submit",a.bind(this.submit,this)),this.searchBox.on("focus",function(){e.onFocus()}),this.searchBox.on("touchstart",function(){e.trigger("touch")}),this.searchBox.on("blur",function(){e.cancel()}),this.cancelBtn.on("click",function(){e.cancel()}),this.historyList.on("click","li",function(t){e.cancel(),e.search(t.currentTarget.innerText)}),d.History.on("add",function(t){e.append(t)}),d.History.on("pop",function(){var t=e.historyList.children();t.eq(t.length-1).remove()}),d.History.on("clear",function(){e.historyList.empty()}),this.clearBtn.on("click",function(){d.History.clear(),e.refresh()}),h.on("change",function(){e.view.$el.find(".city a").html(o())})},submit:function(e){e.preventDefault();var t=this.searchBox.val();this.cancel(),t&&this.search(t)},append:function(e){this.historyList.prepend("<li>"+e+"</li>"),this.refresh()},showHistory:function(){this.historyHolder.show().css("height",r(window).height()-40),this.refresh()},initIscroll:function(){var t=this;e.async("iscroll",function(e){t.scroll=new e(t.historyHolder.get(0),{mouseWheel:!0,click:!0})})},refresh:function(){this.scroll?this.scroll.refresh():this.initIscroll()},onFocus:function(){this.searchBox.parent().addClass("float"),this.cityBox.addClass("float"),this.showCancel(),this.showHistory(),this.trigger("focus")},showBack:function(){this.backBtn.show().addClass("on"),this.cancelBtn.hide()},showCancel:function(){this.backBtn.hide(),this.cancelBtn.show()}});d.History={KEY:"search_history",get:function(){var e=window.localStorage.getItem(this.KEY);return e?e.split(","):[]},add:function(e){var t=this.get();-1===t.indexOf(e)&&(t.unshift(e),t.length>20&&(t.pop(),this.trigger("pop")),window.localStorage.setItem(this.KEY,t.join(",")),this.trigger("add",e))},clear:function(){window.localStorage.removeItem(this.KEY),this.trigger("clear")}},a.extend(d.History,l.Events),i.exports=d},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/common/appdownload/controller",["marionette@~1.4.0","wepp@~2.7.0","./template.html","backbone@~1.1.0","zepto-wepp@~1.1.0","../overlay"],function(e,t,i){var o=e("marionette"),n=e("wepp").Module.BaseView(e("./template.html")),s=e("backbone"),c=e("zepto-wepp");i.exports=o.Controller.extend({initialize:function(t){var i=new s.Model(t),o=new n({model:i});t.region.show(o),i.get("mv")&&o.$el.find(".J_d").on("click",function(){ThisApp.mv(i.get("mv"))});var r=o.$el.find(".J_share");if(r.length){var a=new(e("../overlay")),l=c('<div class="shareguide"></div>').appendTo("body").hide();a.on("show",function(){a.overlay.css({"background-color":"rgba(0,0,0,.9)","z-index":900}),l.show()}),a.on("hide",function(){l.hide()}),l.on("click",function(){a.hide()}),r.on("click",function(e){e.preventDefault(),a.show(),setTimeout(function(){a.hide()},5e3)})}}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/common/alert/controller",["wepp@~2.7.0","./template.html","backbone@~1.1.0","marionette@~1.4.0","underscore@~1.5.0","zepto-wepp@~1.1.0"],function(e,t,i){var o=e("wepp").Module.BaseView(e("./template.html")),n=e("backbone"),s=e("marionette"),c=(e("underscore"),e("zepto-wepp"));i.exports=s.Controller.extend({initialize:function(e){this.view=new o({model:new n.Model(e)}),this.view.render(),this.box=this.view.$el.hide().appendTo("body"),this.box.find(".alert_buttons a").each(function(t,i){e.buttons[t].click&&c(i).on("click",e.buttons[t].click)}),e.buttons&&1===e.buttons.length&&this.box.find(".alert_buttons a").css("width","100%")},show:function(){this.box.show();var e=this.box.find(".confirm_alert");e.css("margin-top",-e.height()/2)},hide:function(){this.box.hide()}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/chosen/layout.html",[],function(e,t,i){i.exports='<div class="nearby"><div class="search_holder Fix"></div><div class="J_cnt"><div class="loading" style="height:400px;"></div></div><div class="download"></div></div><div class="height-box"></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/common/first",["wepp@~2.7.0"],function(e,t,i){var o=e("wepp").Url;i.exports={firstVisit:function(){return null===localStorage.getItem("cityselect")},firstSelect:function(){return"first"===localStorage.getItem("cityselect")},checkFirst:function(){var e=o.get("cityid");return!e&&this.firstVisit()?(localStorage.setItem("cityrefer",location.hash),ThisApp.redirect("#citylist",!0),!0):!1}}},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/chosen/template.html",[],function(e,t,i){i.exports='<%if(categoryList && categoryList.length){var width=parseInt(window.innerWidth/(categoryList.length));%><div class="category Fix"><%categoryList.forEach(function(cat){var c,url;if(cat.id==0){c=\'bonus\';url=cat.enName}else if(cat.id==10){c=\'food\';url=\'#list~c_10\'}else if(cat.id==30){c=\'fun\';url=\'#list~c_30\'}%><a class="item <%=c%>" style="width:<%=width%>px" href="<%=url%>"><div class="icon"><%if(cat.id==0){%><div class="count <%=cat.count?\'\':\'none\'%>"><%=cat.count?(cat.count>99?\'+99\':cat.count):\'\'%></div><%}%></div><%=cat.name%></a><%});%></div><%}%><div class="c-box-tit" style="color:#969696">猜你喜欢</div><div class="nearby-deallist"><%recommendList.forEach(function(deal,i){%><a href="#detail~<%=deal.id%>"><div class="img"><img lazy-src="<%=deal.bigImageUrl%>" width="100%" height="auto"></div><div class="tit"><%=deal.contentTitle%><%if(deal.shopNum && deal.shopNum>1){%><span class="shop-total">【<%=deal.shopNum%>店通用】</span><%}%></div><div class="tip"><%=deal.titleDesc%></div><div class="price"><span class="new-price">￥<%=deal.price%></span><span class="old-price">￥<%=deal.originalPrice%></span><span class="buy-num"><%=deal.buyerCounter%>人</span></div></a><%});%></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/util/lazyload",["zepto-wepp@~1.1.0"],function(e,t,i){var o=e("zepto-wepp"),n="lazy-src",s=function(e){var t=e.slice(0),i=t.length,s=function(){for(var e=o(window).scrollTop()+window.innerHeight,c=0,r=t.length;r>c;c++){var a=o(t[c]);!a.attr("src")&&a.attr(n)&&e>o(a).offset().top&&(a.attr("src",a.attr(n)),i--)}0>=i&&window.removeEventListener("scroll",s,!1)};window.addEventListener("load",s,!1),window.addEventListener("scroll",s,!1),s()};i.exports=s},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/common/search/template.html",[],function(e,t,i){i.exports='<form action="" method="post"><%if(showCity){%><div class="city"><a href="#citylist" onclick="ThisApp.mv({module:\'index_city\'})" ><%=cityname%></a><i class="drop"></i></div><%}%><div class="search_inner <%=showCity?\'\':\'first\'%>"><input type="text" placeholder="商户名，地址等..." class="J_search_box search_box"/><a class="cancel J_cancel" href="javascript:;">取消</a><%if(showBack){%><a class="cancel J_back" href="javascript:history.go(-1);">返回</a><%}%><input type="submit" class="hide"></div></form><div class="J_history history"><div><ul><%history.forEach(function(item){%><li><%=item%></li><%});%></ul><a href="javascript:;" class="clear">清除搜索记录</a></div></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/common/appdownload/template.html",[],function(e,t,i){i.exports='<div class="tip-cnt"><p><%=tipText%></p><p>点击右上角<strong><span class="J_share">【收藏】</span></strong>或<strong><span class="J_share">【分享】</span></strong>给小伙伴们！</p></div><div class="appload"><a href="<%=url%>" class="tip"><i class="arr"></i><%=popText%></a><a href="<%=url%>" class="link J_d"><i class="logo"></i>马上去大众点评享优惠</a></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/common/overlay",["zepto-wepp@~1.1.0","underscore@~1.5.0","backbone@~1.1.0"],function(e,t,i){function o(e){var t=this;this.container=e||"body";var i=this.overlay=r();i.on("touchstart touchmove touchend",function(e){e.preventDefault()}),i.on("touchstart click",function(){t.hide()})}var n=e("zepto-wepp"),s=e("underscore"),c=e("backbone"),r=function(){return n('<div class="overlay" style="z-index:200;"></div>')};o.prototype.show=function(){this.overlay.appendTo(this.container).show(),this.trigger("show")},o.prototype.hide=function(){this.overlay.hide(),this.trigger("hide")},s.extend(o.prototype,c.Events),i.exports=o},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/chosen/controller",["zepto-wepp@~1.1.0","../../entities/chosen","wepp@~2.7.0","./template.html","../../util/lazyload","hippo@~1.2.0"],function(e,t,i){var o=e("zepto-wepp"),n=e("../../entities/chosen");i.exports=e("wepp").Module.BaseController.extend({initModel:function(e){return new n(e)},initTpl:function(){return e("./template.html")},onRender:function(){var t=this,i=t.view,n=i.$el.find(".img");n.length&&n.height(200*n.width()/320),n.find("img").each(function(e,t){o(t).on("load",function(){o(this).parent().css("height","auto")})}),e("../../util/lazyload")(i.$el.find(".img img")),t.show=function(){i.$el.show()},t.hide=function(){i.$el.hide()};var s=e("hippo");s.push(["mv",{module:"index_recom_view",action:"browse",reqid:this.model.get("request_id")}]),i.$el.find(".nearby-deallist a").each(function(e,i){o(i).on("click",function(){s.push(["mv",{module:"index_recom_item",action:"click",index:e,reqid:t.model.get("request_id")}])})}),t.trigger("render")},hide:function(){},show:function(){}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/entities/chosen",["backbone@~1.1.0","underscore@~1.5.0","wepp@~2.7.0"],function(e,t,i){var o=e("backbone"),n=e("underscore"),s=e("wepp"),c=s.Url,r=s.Module.City;i.exports=o.Model.extend({initialize:function(e){var t=n.extend({from:"weixin",category:10,distance:2e3,number:20,type:1},e);this.url="getwxhomepagedatagn.json?"+c.stringify(t)},parse:function(e){if(e&&200===e.code){var t=e.data.recommendDeals;t.city&&r.set({id:t.city.id,name:t.city.name,enName:t.city.enName});var i=(t.list||[]).map(function(e){return e.shopNum=e.shopIdsStr?e.shopIdsStr.split(",").length:0,e});return{categoryList:e.data.categoryList&&e.data.categoryList.list||[],recommendList:i||[],hotModules:e.data.hotModules||[],request_id:e.request_id}}return{categoryList:[],recommendList:[],hotModules:[],request_id:e.request_id}}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/pages/chosen",["zepto-wepp@~1.1.0","underscore@~1.5.0","wepp@~2.7.0","../modules/chosen/controller","../modules/common/first","../modules/common/search/controller","../modules/common/appdownload/controller","../modules/common/alert/controller","../modules/chosen/layout.html"],function(e,t){var i=(e("zepto-wepp"),e("underscore")),o=e("wepp"),n=e("../modules/chosen/controller"),s=o.Module.City,c=o.UI,r=e("../modules/common/first"),a=e("../modules/common/search/controller"),l=e("../modules/common/appdownload/controller"),h=e("../modules/common/alert/controller");t.Controller=o.PageController.extend({show:function(){ThisApp.Menu.show().switchTo(0),this.firstSelect=r.firstSelect();var e=this;ThisApp.openPage(!0).then(function(t){e.page=t,e.region(),e.fetchList(t)},function(t){e.page=t,t._cached_city!=s.getId()&&(ThisApp.Menu.setUrl(1,"#list~c_10~f_2"),e.fetchList(e.page))})},fetchList:function(e){var t=this;t.initSearch(e.layout.search),t.cookieGeo()||ThisApp.Geo.get(!0).then(function(e){t.geo(e)},function(){if(!t.firstSelect&&ThisApp.pageRegion.isCurrentPage(t.page)){var e=new h({content:"无法获取到您的定位",buttons:[{text:"切换城市",url:"#citylist",click:function(){e.hide()}},{text:"取消",click:function(){e.hide(),t.showCurrentCity()}}]});c.loading.hide(),e.show()}else t.showCurrentCity()})},showChosen:function(e){var t=this,i=this.chosen=new n(e);i.render(this.page.layout.chosen);var o=+new Date;e.lat&&this.setNearByUrl(e.lat,e.lng),i.model.on("change",function(e){t.performance.set({r_api:+new Date-o});var i=e.get("list");ThisApp.Share.config({img_url:i&&i[0]&&i[0].bigImageUrl,link:location.href})}),t.page._cached_city=e.cityid,i.on("render",function(){t.download(),t.performance.set({r_ready:+new Date-t.performance.startTime,r_load:+new Date-t.performance.startTime})})},region:function(){this.page.initRegion({template:i.template(e("../modules/chosen/layout.html")),regions:{search:".search_holder",chosen:".J_cnt",download:".download"}})},cookieGeo:function(){var e=ThisApp.Geo.cookieGeo();return e&&e.cityid===s.getId()?(this.showGeoCity(e),!0):!1},geo:function(e){var t=this;if(s.getId()==e.cityid)this.showGeoCity(e);else if(!this.firstSelect&&ThisApp.pageRegion.isCurrentPage(this.page)){var i=new h({content:"系统定位到您在"+e.cityname+",是否切换?",buttons:[{text:"取消",click:function(){t.showCurrentCity(),i.hide()}},{text:"切换",click:function(){i.hide(),t.showGeoCity(e)}}]});c.loading.hide(),i.show()}else t.showCurrentCity()},showGeoCity:function(e){this.showChosen({cityid:e.cityid,lat:e.lat,lng:e.lng})},showCurrentCity:function(){this.showChosen({cityid:s.getId()})},setNearByUrl:function(e,t){ThisApp.Menu.setUrl(1,"#list~c_10~f_2~lat_"+e+"~lng_"+t)},initSearch:function(e){var t=this,i=new a;i.show(e),i.on("touch",function(){ThisApp.Menu.hide()}),i.on("focus",function(){ThisApp.Menu.hide(),t.chosen&&t.chosen.hide(),ThisApp.mv({module:"index_search"})}),i.on("blur",function(){ThisApp.Menu.show(),t.chosen&&t.chosen.show()}),i.on("search",function(e){ThisApp.redirect("#list~k_"+encodeURIComponent(e))})},download:function(){new l({url:"http://m.api.dianping.com/downloadlink?redirect=3123",region:this.page.layout.download,tipText:"喜欢精选美食频道吗?",popText:"发现更多优惠，还能获得现金返利",mv:{module:"index_download"}})}})},{asyncDeps:["iscroll@~5.0.9"]});
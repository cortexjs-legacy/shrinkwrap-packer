define("unit-m-weixin@1.12.6/js/modules/common/alert/template.html",[],function(e,t,i){i.exports='<div class="overlay"></div><div class="confirm_alert"><div class="alert_content"><%=content%></div><div class="alert_buttons"><%buttons.forEach(function(btn){%><a href="<%=(btn.url||\'javascript:;\')%>"><%=btn.text%></a><%});%></div></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/pay/layout.html",[],function(e,t,i){i.exports='<div class="neworder"><div class="J_deal"></div><div class="J_pay"><div class="loading" style="height:140px;"></div></div><div class="J_mobile"></div><div class="J_delivery"></div><div class="J_submit"></div><div class="height-box"></div></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/entities/detail",["backbone@~1.1.0","../base/weixin","wepp@~2.7.0","./dealstatus"],function(e,t,i){var n=e("backbone"),o=e("../base/weixin"),s=e("wepp").ENV,a=e("./dealstatus");i.exports=n.Model.extend({initialize:function(e){this.param=e,this.setUrl(),this.fetch()},baseUrl:"/ajax/tuan/dealgn.json?",setUrl:function(){this.url=this.baseUrl+"id="+this.param.id+"&cityid="+this.param.cityid+(window.HIPPO_DATA&&window.HIPPO_DATA.request_id?"&rid="+window.HIPPO_DATA.request_id:"")},parse:function(e){var t=e.data;t.price=-1!==t.price.toString().indexOf(".")?(+t.price).toFixed(2):t.price,t.status=this.getDealStatus(t.status),t.time=this.getTime(t,t.status),t.yuyue=1===t.tag;var i,n,a,l=t.dealSelects;if(a=i=1==l.length?"#order~g_"+t.id+"~d_"+l[0].id:"#dealselect~g_"+t.id,o.isInWeixin()&&!ThisApp.isLogin?(i=encodeURIComponent(location.href.replace(/#[\w\W]+/,"")+i),n="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+s.get("appid")+"&redirect_uri="+s.get("cpsUrl")+"/weiXinRedirect&response_type=code&scope=snsapi_base&state="+i+"#wechat_redirect"):n=i,t.nextUrl=n,t.originGoToUrl=a,t.extra=(t.extra||[]).map(function(e){return{title:e.id,cont:e.name.replace(/\n/g,"<br/>"),red:4==e.type}}),t.shopNum=t.shopIdsStr?t.shopIdsStr.split(",").length:0,this.param.selectId){var r=this;t.selectDeal=(t.dealSelects.filter(function(e){return e.id==r.param.selectId})||[])[0]}return t.count=t.buyMixCount,t},getDealStatus:function(e){return a.isSellOut(e)?1:a.isEnd(e)?2:a.isCantBuy(e)?3:a.isToBegin(e)?4:0},getTime:function(e,t){var i;if(1==t||2==t||4==t){var n=new Date(e.time);i=n.getFullYear()+"年"+(n.getMonth()+1)+"月"+n.getDate()+"日",i=4==t?"开始于"+i+n.getHours()+":"+n.getMinutes():"结束于"+i}else{var o=e.time-(new Date).getTime(),s=o/864e5;if(s>=3)i="剩余3天以上";else if(s>=1&&3>s)i="剩余"+parseInt(s)+"天";else{var a=parseInt(s),l=parseInt(o/36e5-24*a),r=parseInt(o/6e4-1440*a-60*l);i="剩余"+(a>0?a+"天":"")+l+"小时"+r+"分"}}return i}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/pay/dealinfo/template.html",[],function(e,t,i){i.exports='<div class="titles"><h3><%= selectDeal.title %></h3><div><span class="support Left"><% if(refund){%><i class="icon-s"></i>支持随时退</span><span class="support Left"><i class="icon-s"></i>支持过期退</span><%}else{%><i class="icon-e"></i>不支持随时退</span><span class="support Left"><i class="icon-e"></i>不支持过期退</span><%}%></div></div><div class="c-box"><% if(dealType != 3){%><div class="item">单价：<span class="Right">¥<%= selectDeal.priceStr %></span></div><div class="item">数量：<%if(buyMixCount != 1){%>(至少买<%=buyMixCount%>份)<%}%><%if(isLimitPerUser){%>(可购买<%=buyLimit%>份)<%}%><span class="Right"><a onclick="ThisApp.mv({module:\'order_reducenum\'})" class="op J_delete <%=count<=buyMixCount?\'dis\':\'\'%>" href="javascript:;">-</a><input readonly type="text" value="<%=count%>" class="buy-cnt"><a onclick="ThisApp.mv({module:\'order_addnum\'})" class="op J_add <%=count>=buyLimit?\'dis\':\'\'%>" href="javascript:;" >+</a></span></div><div class="item">总价：<span class="Right">¥<%=(count*selectDeal.priceStr).toFixed(2)%></span></div><%}%></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/pay/delivery/controller",["wepp@~2.7.0","../../../entities/delivery","../../../util/cache","./template.html"],function(e,t,i){{var n=e("wepp"),o=e("../../../entities/delivery");e("../../../util/cache")}i.exports=n.Module.BaseController.extend({initModel:function(e){var t=new o;return t.set("deliveryType",e.get("deliveryType")),t.set("temp",!1),t},initTpl:function(){return e("./template.html")},ready:function(){return this._check()},_check:function(){return this.model.get("temp")&&this.model.get("temp").showAddress||this.model.get("select")?!0:(n.UI.alert("请先填写地址"),!1)},getData:function(){var e={},t=this.model.get("select");return t?e=t.id?{deliveryid:t.id}:t:this.model.get("temp")&&(e=this.model.get("temp")),e.deliverytype=this.view.$el.find("select").val(),e.memo=this.view.$el.find(".invoice").val()||"",e}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/pay/mobile/template.html",[],function(e,t,i){i.exports='<%if(isLogin && mobilePhone){%><div class="c-box"><div class="item">您绑定的手机号<span class="Right"><%=mobilePhoneMasked%></span></div></div><%}%><%if(hasThirdCookie && !isLogin){%><div class="c-box"><a class="item" href="<%=bindUrl%>">绑定点评账号<i class="arrow-ent"></i></a></div><%}%><%if((isLogin&&needMobile&&!mobilePhone) || (!isLogin&&(needMobile||!hasThirdCookie))){%><p class="c-box-tit"><b style="color:red">*</b> 绑定手机号</p><div class="c-box mobile-bind"><div class="item">手机号&nbsp;<input class="J_mobile_input com-input" placeholder="请输入您的手机号" type="number"><div class="send"><a class="J_send"  href="javascript:;">获取验证码</a><a class="J_sending dis hide" href="javascript:;"></a></div></div><div class="item">验证码&nbsp;<input class="J_code_input com-input" placeholder="请输入短信验证码" type="number"></div></div><%}%>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/entities/payment",["wepp@~2.7.0","zepto-wepp@~1.1.0","backbone@~1.1.0"],function(e,t,i){var n=e("wepp"),o=e("zepto-wepp");i.exports=e("backbone").Model.extend({url:function(){return n.ENV.get("payDomain")+"/ajax/tuan/createordermm.jsonp?random="+ +new Date+"&channel=weixin&groupid="+this.get("dealGroupId")+"&dealid="+this.get("dealId")+"&cityid="+n.Module.City.getId()},parse:function(e){var t=e.data;return t.dealDiscount=0,t.isLogin=!!t.userId,t},fetch:function(){var e=this;o.ajax({url:this.url(),dataType:"jsonp",success:function(t){200===t.code&&e.set(e.parse(t))}})}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/pay/payment/template.html",[],function(e,t,i){i.exports='<div class="c-box"><%if(originPrice && isLogin && canUseDiscount){%><a class="item" href="#paypromo">优惠代码<%=discountList&&discountList.length?\'/抵用券\':\'\'%><%if(discount){%><span class="Right">￥<%=discount%></span><%}else{%><i class="arrow-ent"></i><%}%></a><%}%><%if(dealDiscount || payDiscount){%><div class="item">立减<span class="Right">￥<%=((+dealDiscount||0)+(+payDiscount||0)).toFixed(2)%></span></div><%}%><div class="item hl"> 还需支付<span class="Right">￥<%=needToPay.toFixed(2)%></span><%if(originPrice && payDiscount){%><%if(paymentType && paymentType[0] && paymentType[0].highlightTitle){%><%if(paymentType[0].highlightTitle){%><p class="paytip"><%=paymentType[0].highlightTitle%></p><%}%><%if(paymentType[0].subTitle){%><p class="paytip"><%=paymentType[0].subTitle%></p><%}}%><%}%></div></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/pay/submit/template.html",[],function(e,t,i){i.exports='<a href="javascript:;"  class="y-btn J_submit" style="width:95%;margin:0 auto;">微信支付</a><a href="javascript:;"  class="n-btn J_submiting hide" style="width:95%;margin:0 auto;">正在处理</a>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/common/alert/controller",["wepp@~2.7.0","./template.html","backbone@~1.1.0","marionette@~1.4.0","underscore@~1.5.0","zepto-wepp@~1.1.0"],function(e,t,i){var n=e("wepp").Module.BaseView(e("./template.html")),o=e("backbone"),s=e("marionette"),a=(e("underscore"),e("zepto-wepp"));i.exports=s.Controller.extend({initialize:function(e){this.view=new n({model:new o.Model(e)}),this.view.render(),this.box=this.view.$el.hide().appendTo("body"),this.box.find(".alert_buttons a").each(function(t,i){e.buttons[t].click&&a(i).on("click",e.buttons[t].click)}),e.buttons&&1===e.buttons.length&&this.box.find(".alert_buttons a").css("width","100%")},show:function(){this.box.show();var e=this.box.find(".confirm_alert");e.css("margin-top",-e.height()/2)},hide:function(){this.box.hide()}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/pay/submit/controller",["wepp@~2.7.0","../../../util/ajax","backbone@~1.1.0","./template.html","../../common/alert/controller"],function(e,t,i){var n=e("wepp"),o=e("../../../util/ajax"),s=n.UI;i.exports=n.Module.BaseController.extend({initModel:function(t){return this.pageController=t.pageController,new(e("backbone").Model.extend())},initTpl:function(){return e("./template.html")},onRender:function(e,t){var i=this;i.btn=t.$el.find(".J_submit"),i.unBtn=t.$el.find(".J_submiting"),i.btn.on("click",function(){i.pageController.message("try:submit",function(e){e&&i.submit(e)})})},render:function(e){return this.region=e,this},submit:function(e){this.unBtn.removeClass("hide"),this.btn.addClass("hide");var t=this;o({url:n.ENV.get("payDomain")+"/ajax/tuan/confirmordermm.jsonp?random="+ +new Date+"&"+n.Url.stringify(e),dataType:"jsonp"},{},{finish:function(){t.btn.removeClass("hide"),t.unBtn.addClass("hide")},200:function(i){return i.needReconfirm?void t.reconfirm(i,e):void(0===i.flag?ThisApp.redirect("#paysuc~"+i.returnID):t.weixinPay(JSON.parse(i.content),i.returnID))}})},weixinPay:function(e,t){var i=navigator.userAgent.match(/MicroMessenger\/([^\.]+)/);i&&parseInt(i[1])>4?WeixinJSBridge.invoke("getBrandWCPayRequest",e,function(e){"get_brand_wcpay_request:ok"==e.err_msg?ThisApp.redirect("#paysuc~"+t):s.alert("get_brand_wcpay_request:cancel"==e.err_msg?"支付取消":"支付失败")}):s.alert("您的微信版本过低，不能使用支付功能，请升级客户端版本。")},reconfirm:function(t,i){var n=e("../../common/alert/controller"),o='<div class="reconfirm">',s=!1,a=this;t.reductionPrice&&(o+="<p>"+t.reductionDesc+"</p>"),t.discountList&&t.discountList.discountList&&t.discountList.discountList.length&&!i.discount&&(o+="<p>您有"+t.discountList.discountList.length+'张优惠券可用:</p><ul class="coupon_list">',t.discountList.discountList.forEach(function(e,t){o+='<li><label><input type="radio" name="coupon" value="'+t+'" '+(0===t?"checked":"")+">"+e.title+"</label></li>"}),o+="</ul>",s=!0),o+="</div>";var l={channel:i.channel,utm:i.utm,dealid:i.groupid,orderid:t.returnID,paymentamount:i.paymentamount,paymenttype:i.paymenttype,discountid:i.discountid},r=[{text:s?"确定使用":"确定",click:function(){if(d.hide(),s){var e=d.view.$el.find("input[checked]").val(),i=t.discountList.discountList[e];a.pageController.message("change:discount",i,function(e){l.paymentamount=e,l.discountid=i.id})}t.reducePrice&&a.pageController.message("change:reduce",t.reducePrice,function(e){l.paymentamount=e}),a.repay(l)}}];s&&r.push({text:"不使用",click:function(){d.hide(),t.reducePrice&&a.pageController.message("change:reduce",t.reducePrice,function(e){l.paymentamount=e}),a.repay(l)}});var d=new n({content:o,buttons:r});d.show(),s||setTimeout(function(){r[0].click()},2e3)},repay:function(e){var t=this;o({url:n.ENV.get("payDomain")+"/ajax/tuan/confirmordergn.jsonp?random="+ +new Date+"&"+n.Url.stringify(e),dataType:"jsonp"},{},{200:function(i){0===i.flag?ThisApp.redirect("#paysuc~"+e.orderid):t.weixinPay(JSON.parse(i.content),e.orderid)}})}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/entities/delivery",["backbone@~1.1.0","underscore@~1.5.0"],function(e,t,i){{var n=e("backbone");e("underscore")}i.exports=n.Model.extend({url:"/ajax/tuan/deliverylistgn.json?",parse:function(e){return 200===e.code?(e.data.isLogin=!0,e.data.select=e.data.list[0]||null,e.data):{isLogin:!1,select:null,list:[]}}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/pay/payment/controller",["wepp@~2.7.0","../../../entities/payment","../../../util/cache","./template.html"],function(e,t,i){var n=e("wepp"),o=e("../../../entities/payment"),s=e("../../../util/cache");i.exports=n.Module.BaseController.extend({initModel:function(e){this.options=e;var t=new o({dealGroupId:e.dealGroupId,dealId:e.dealId});t.set({discount:0,discountid:""});var i=this;return this.dealModel=e.dealModel,e.dealModel.on("change",function(){i.checkModel(t),i._discountList()}),t.on("change",function(){i._discountList()}),t},initTpl:function(){return e("./template.html")},onRender:function(){this._ready=!0},_caculate:function(){var e=this.model,t=this.dealModel;if(!e.get("paymentType")||!t.get("count"))return!1;var i=t.get("count")*t.get("selectDeal").priceStr,n=0;e.get("reductionAmountStr")&&e.get("reductionLimitStr")&&i>+e.get("reductionLimitStr")&&(n=e.get("reductionAmountStr"),i-=n);var o=e.get("discount"),s=e.get("paymentType")[0].eventDiscountAmount,a=e.get("paymentType")[0].eventLimitAmount,l=i-o;return l>s&&i>a?l-=s:s=0,l=0>l?0:l,{total:i,needToPay:l,dealDiscount:n,payDiscount:s}},checkModel:function(){var e=this._caculate();return e?(this.model.set({needToPay:e.needToPay,dealDiscount:e.dealDiscount,payDiscount:e.payDiscount,canUseBalance:this.dealModel.get("canUseBalance"),canUseDiscount:this.dealModel.get("canUseDiscount"),originPrice:+this.dealModel.get("selectDeal").priceStr}),!0):!1},_discountList:function(){var e=this._caculate();if(e){var t=this.model,i=(t.get("discountList")||[]).filter(function(t){return+t.priceLimitStr<=e.total});s.set("CounponListCache",{discountList:i,count:this.dealModel.get("count"),dealGroupId:this.options.dealGroupId,dealId:this.options.dealId});var n=t.get("discountid"),o=n&&"coupon"==t.get("discountType")&&0===i.filter(function(e){return e.id==n}).length;o&&t.set({discount:0,discountid:""})}},ready:function(){return!!this._ready}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/pay/delivery/template.html",[],function(e,t,i){i.exports='<div class="c-box-tit">送货信息</div><div class="c-box delivery"><%if(select || temp){var d=select || temp;var link=!isLogin?\'#deliveryadd~temp\':\'#deliverylist\'%><a class="item" style="padding-bottom:10px;padding-right:60px;" href="<%=link%>"><div class="memo"><%=d.receiver%> <%=d.phoneNo || d.phone%></div><div class="info"><%=d.showAddress%></p><p class="info"><%=d.postCode || d.postcode%></div><span class="arrow-txt">更改</span><span class="arrow-ent"></span></a><%}else{if(isLogin){%><a href="#deliveryadd~0" class="item">添加收货地址<span class="arrow-ent"></span></a><%}else{%><a href="#deliveryadd~temp" class="item">添加收货地址<span class="arrow-ent"></span></a><%}}%><div class="item">时间:<select><%deliveryType.forEach(function(t){%><option value="<%=t.id%>"><%=t.name%></option><%});%></select></div><div class="item">附言：<input type="text" placeholder="特殊配送要求，我们尽量满足" class="com-input invoice"></div></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/pay/mobile/controller",["underscore@~1.5.0","wepp@~2.7.0","zepto-wepp@~1.1.0","backbone@~1.1.0","cookie@~0.1.0","../../../util/ajax","./template.html"],function(e,t,i){function n(e){return/^1\d{10}$/.test(e)}var o=(e("underscore"),e("wepp")),s=(e("zepto-wepp"),e("backbone")),a=o.UI,l=o.ENV,r=e("cookie"),d=e("../../../util/ajax");i.exports=o.Module.BaseController.extend({initModel:function(e){var t=this,i=e.dealModel,n=e.paymentModel,o=new(s.Model.extend());o.fetch=function(){};var a=!1,d=!1,c=function(){if(a&&d){var e=3==i.get("dealType"),s=!!i.get("isThirdParty"),c=0==i.get("price");o.set({isLottery:e,isThird:s,isZero:c,hasThirdCookie:r("_thirdu.c")||!1,needMobile:e||s||c,bindUrl:l.get("accountDomain")+"/bind?redir="+encodeURIComponent(location.href.replace("showwxpaytitle=1","showwxpaytitle=1&x")),isLogin:n.get("isLogin"),mobilePhone:n.get("phoneNO"),mobilePhoneMasked:t.maskMobile(n.get("phoneNO"))}),void 0===o.get("isnewlogin")&&o.set("isnewlogin",!n.get("isLogin"))}};return i.on("change",function(){a=!0,c()}),n.on("change",function(){d=!0,c()}),o},initTpl:function(){return e("./template.html")},onRender:function(e,t){var i=this;t.$el.find(".J_send").on("click",function(){i.sendCode()})},finish:function(e){var t=this.model,i=t.get("mobilePhone"),n=t.get("needMobile");!t.get("isLogin")||n&&!i?this._login(e):i||!n?e(i||""):a.alert("请先绑定手机哦~")},_login:function(e){var t,i=this._check(),n=this,o=n.model,s=o.get("mobilePhone"),l=o.get("needMobile"),r=o.get("hasThirdCookie"),c=o.get("isLogin");return c&&o.set("isnewlogin",!1),!c||l&&!s?void(i&&(c?s||(t="/ajax/tuan/BindPhonegn.json",i.phone=i.mobile,i.code=i.vcode,i.callid=parseInt((Math.random()+"").substr(2,15))):r&&l?t="/ajax/account/mobiledynamiclogin/3":r?r&&!l&&(t="/ajax/account/thirdpartlogin"):t="/ajax/account/mobiledynamiclogin/2",d(t,i,{200:function(){n.model.set({isLogin:!0,mobilePhone:i.mobile,mobilePhoneMasked:n.maskMobile(i.mobile)}),e(i.mobile)},other:function(e,t){a.alert(t.msg&&t.msg.err||"出错啦，请稍后再试")}}))):void e(s||"")},_check:function(){var e=this.view.$el,t=this.model,i=t.get("needMobile"),o=t.get("hasThirdCookie"),s=t.get("isLogin");if(i&&!t.get("mobilePhone")||!o&&!s){var l=e.find(".J_code_input").val().trim(),r=e.find(".J_mobile_input").val().trim();return n(r)?l?{mobile:r,vcode:l}:(a.alert("验证码不能为空"),!1):(a.alert("无效手机号"),!1)}return{mobile:"",vcode:""}},ready:function(){return this._check()},setMobile:function(e){var t=this.maskMobile(e);this.model.set({mobilePhone:e,mobilePhoneMasked:t})},maskMobile:function(e){return e?(e=e.toString(),e.slice(0,3)+"****"+e.slice(7)):""},sendCode:function(){var e=this.view.$el.find(".J_mobile_input").val().trim();if(!n(e))return void a.alert("无效的手机号");var t,i=this,o=i.model;t=o.get("isLogin")?"/ajax/tuan/sendverifycodegn.json":o.get("hasThirdCookie")?"/ajax/account/mobiledynamiclogincode/3":"/ajax/account/mobiledynamiclogincode/2",d(t,{mobile:e,phone:e,callid:parseInt((Math.random()+"").substr(2,15)),rebind:1},{200:function(){a.alert("验证码已发送"),i._timeout()}})},_timeout:function(){var e=this.view.$el,t=e.find(".J_send").addClass("hide"),i=e.find(".J_sending").removeClass("hide").html("60秒后重发"),n=setInterval(function(){var e=parseInt(i.html());1==e&&(clearInterval(n),i.addClass("hide"),t.removeClass("hide")),i.html(e-1+"秒后重发")},1e3)}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/base/weixin",[],function(e,t){var i=navigator.userAgent;t.isInWeixin=function(){return/MicroMessenger/.test(i)},t.version=function(){var e=i.match(/MicroMessenger\/(\d+\.\d+)/);try{return e?Number(e[1])||0:0}catch(t){return 0}}},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/pay/dealinfo/controller",["wepp@~2.7.0","../../../util/cache","backbone@~1.1.0","../../../entities/detail","./template.html"],function(e,t,i){{var n=e("wepp"),o=e("../../../util/cache"),s=e("backbone"),a=e("../../../entities/detail");n.UI}i.exports=n.Module.BaseController.extend({initModel:function(e){var t,i=o.get("DealCache");if(i&&i.id==e.dealGroupId){t=new(s.Model.extend({}));var l=(i.dealSelects.filter(function(t){return t.id==e.dealId})||[])[0];return i.selectDeal=l,t.fetch=function(){setTimeout(function(){t.set(i)},0)},t}return t=new a({id:e.dealGroupId,cityid:n.Module.City.getId(),selectId:e.dealId})},initTpl:function(){return e("./template.html")},onRender:function(e,t){var i=t.$el,n=this;this._ready=!0,i.find(".J_add").on("click",function(){n.changeAmount(e.get("count")+1)}),i.find(".J_delete").on("click",function(){n.changeAmount(e.get("count")-1)})},changeAmount:function(e){var t=this.model;e=+e;{var i=+t.get("buyMixCount"),n=+t.get("isLimitPerUser")?t.get("buyLimit"):9999;this.view.$el}e>n||i>e||this.model.set({count:e})},ready:function(){return!!this._ready}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/entities/dealstatus",[],function(e,t,i){var n={getStr:function(e){return e.toString(2).split("").reverse().join("")},isNew:function(e){var t=this.getStr(e);return parseInt(t[0])},isSellOut:function(e){var t=this.getStr(e);return parseInt(t[1])},isEnd:function(e){var t=this.getStr(e);return parseInt(t[2])},isCantBuy:function(e){var t=this.getStr(e);return parseInt(t[3])},isToBegin:function(e){var t=this.getStr(e);return parseInt(t[4])},isNormal:function(e){var t=this.getStr(e);return parseInt(t[5])}};i.exports=n},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/util/cache",[],function(e,t,i){function n(e){return e in s?s[e]:null}function o(e){return a?JSON.parse(localStorage.getItem(e)):null}var s={},a="localStorage"in window&&null!==window.localStorage,l={has:function(e){return e in s||a&&null!==localStorage.getItem(e)},get:function(e){return null!==n(e)?n(e):o(e)},set:function(e,t){s[e]=t,a&&localStorage.setItem(e,JSON.stringify(t))},remove:function(e){delete s[e],a&&localStorage.removeItem(e)}};i.exports=l},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/util/ajax",["wepp@~2.7.0","zepto-wepp@~1.1.0","underscore@~1.5.0"],function(e,t,i){var n=e("wepp").UI,o=e("zepto-wepp"),s=e("underscore"),a=function(e){n.alert(e.data.content,2e3)};i.exports=function(e,t,i){var l={url:"",data:t||{},type:"POST",dataType:"json",success:function(e){i.finish&&i.finish(),i.success&&i.success(e.data);var t=e.code;200===t?i[200](e.data):i.other?i.other(e.data,e):i[t]?i[t](e.data):a(e)},error:function(){i.finish&&i.finish(),n.alert("网络出错,请稍后再试哦~")}};"string"==typeof e?l.url=e:s.extend(l,e),o.ajax(l)}},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/pages/pay",["zepto-wepp@~1.1.0","underscore@~1.5.0","wepp@~2.7.0","../util/cache","../modules/pay/dealinfo/controller","../modules/pay/mobile/controller","../modules/pay/payment/controller","../modules/pay/submit/controller","../modules/pay/delivery/controller","../modules/pay/layout.html"],function(e,t){var i,n,o=(e("zepto-wepp"),e("underscore")),s=e("wepp"),a=(e("../util/cache"),e("../modules/pay/dealinfo/controller")),l=e("../modules/pay/mobile/controller"),r=e("../modules/pay/payment/controller"),d=e("../modules/pay/submit/controller"),c=e("../modules/pay/delivery/controller");t.Controller=s.PageController.extend({initialize:function(){var e=this;this.onMessage("try:submit",function(t){e.allReady()&&e.mobile.finish(function(a){var l={dealid:e.deal.model.get("selectDeal").id,groupid:e.deal.model.get("id"),count:e.deal.model.get("count"),channel:"weixin",utm:s.Url.get("utm"),paymentamount:i.model.get("needToPay"),paymenttype:i.model.get("paymentType")[0].id,discountid:i.model.get("discountid")||"",phoneNo:a||"",cityid:s.Module.City.getId(),isnewlogin:e.mobile.model.get("isnewlogin")||!1};e.hasDelivery&&o.extend(l,n.getData()),t(l)})}),this.onMessage("login",function(e){i&&i.set("isLogin",e)}),this.onMessage("change:discount",function(e,t){i.model.set({discountid:e.id,discount:e.priceStr}),t(i.model.get("needToPay"))}),this.onMessage("change:reduce",function(e,t){i.model.set({reductionAmountStr:e,reductionLimitStr:"0.0"}),t(i.model.get("needToPay"))}),ThisApp.commands.setHandler("promo::update",function(e){i&&i.model.set({discount:e.discount,discountid:e.discountId,discountType:e.couponType})}),ThisApp.commands.setHandler("temp::delivery::add",function(e){n&&n.model.set("temp",e)}),ThisApp.commands.setHandler("delivery::update",function(e){n&&n.model.set(e.id?{temp:!1,select:e}:{temp:e,select:!1})}),ThisApp.commands.setHandler("delivery::add",function(e){n&&n.model.set("select",e)}),e.hasDelivery=!1},show:function(e,t){var s=this;ThisApp.openPage().then(function(u){s._region(u);var p={dealGroupId:e,dealId:t},m=s.deal=new a(p),h=m.model;m.render(u.layout.deal),i=new r(o.extend(p,{dealModel:h})).render(u.layout.payment),s.mobile=new l({dealModel:h,paymentModel:i.model}).render(u.layout.mobile);var f=s.submit=new d({pageController:s}).render(u.layout.submit);i.model.once("change",function(){f.model.set("show",!0)}),h.once("change",function(){2==h.get("dealType")&&(s.hasDelivery=!0,n=new c(h),n.render(u.layout.delivery))})})},_region:function(t){t.initRegion({template:o.template(e("../modules/pay/layout.html")),regions:{deal:".J_deal",payment:".J_pay",mobile:".J_mobile",delivery:".J_delivery",submit:".J_submit"}})},allReady:function(){return i.ready()&&this.deal.ready()&&(this.hasDelivery&&n.ready()||!this.hasDelivery)}})},{asyncDeps:["iscroll@~5.0.9"]});
define("unit-m-weixin@1.12.6/js/modules/promo/content/controller",["marionette@~1.4.0","./view","backbone@~1.1.0","underscore@~1.5.0"],function(e,t,o){var i=e("marionette"),n=e("./view"),r=e("backbone"),a=new r.Router,l=e("underscore");o.exports=i.Controller.extend({initialize:function(e){this.orderId=e.orderId},show:function(e){var t=JSON.parse(localStorage.orderConfirm);l.map(t.discountList,function(e){var t=new Date(e.expiredDate);e.expiredDate=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}),this.orderId!=t.orderId&&a.navigate("#",!0);var o=r.Model.extend({initialize:function(e){this.set(e)}});this.view=new n({model:new o(t)}),e.show(this.view)}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/promo/layout.html",[],function(e,t,o){o.exports='<div class="J_cnt"><div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/promo/content/view",["marionette@~1.4.0","backbone@~1.1.0","underscore@~1.5.0","zepto-wepp@~1.1.0","cookie@~0.1.0","wepp@~2.7.0","./template.html"],function(e,t,o){var i=e("marionette"),n=e("backbone"),r=(new n.Router,e("underscore")),a=e("zepto-wepp"),l=e("cookie"),s=e("wepp").UI;o.exports=i.ItemView.extend({template:r.template(e("./template.html")),tagName:"div",events:{"click .J_promo":"couponSelect","click .J_promo_submit":"promo_send"},initialize:function(){this.value=""},couponSelect:function(e){var t,o,i,n=a(e.currentTarget),l=this;a("input[type='radio']").removeAttr("checked"),n.find("input[type='radio']").attr("checked","true"),l.value=n.find("input[type='radio']").val(),t=l.model,o=t.get("discountList")||[],i=r.filter(o,function(e){return e.id==l.value?!0:!1}),this.result=i.length?i[0]:!1},promo_send:function(e){if(e.preventDefault(),!this.checkPromoCode())return!1;this.model;ThisApp.execute("order::promo::update",this.result||""),history.go(-1)},checkPromoCode:function(){var e=this,t=e.model,o=!0;if(a(".J_promo_input").attr("checked")){var i=a(".J_promo_code").val();if(!i)return s.alert("代码不能为空"),!1;var n=parseInt(l("promoNum"))||0;if(n>10)return s.alert("操作频繁，请20分后再试。"),!1;a.ajax({url:"/ajax/tuan/verifyCouponCodegn.json",data:{groupid:t.get("groupId"),dealid:t.get("dealId"),count:t.get("count"),cityid:t.get("cityId"),code:a(".J_promo_code").val()},type:"POST",async:!1,dataType:"json",success:function(t){if(200==t.code)e.result=t.data,a(".J_promo_code").val("");else{var i=t.data;o=!1,s.alert(i.content)}}}),n?l("promoNum",parseInt(n)+1):l("promoNum",1,{expires:1/72})}return o}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/promo/content/template.html",[],function(e,t,o){o.exports='<div class="Box"><h5>选择您要使用的优惠，无效抵用券将不会显示</h5><div class="order-box no-p"><ul id="J_couponList"><li><a class="fill J_promo" href="javascript:void(0);"><label>不使用优惠</label></td><input name="couponIDString" class="radio-input" type="radio" checked value=""></a></li><%_.each(discountList,function(item){ %><li><a class="fill J_promo" href="javascript:void(0);"><table cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><span><%= item.title %></span><p><%= item.expiredDate %>&nbsp;&nbsp;过期</p></td><td width="30" align="right" valign="middle"><input  name="couponIDString"  class="radio-input" type="radio" value="<%= item.id %>"></td></tr></tbody></table></a></li><% }) %><li><a class="fill J_promo" href="javascript:void(0);"><input id="couponcode" type="text" placeholder="填写优惠代码" class="test-input J_promo_code" name="couponCode"></td><input  name="couponIDString" class="radio-input J_promo_input" type="radio" value="coupon"></tr></tbody></table></a></li></ul></div></div><div class="Box"><a href="javascript:void(0)"  type="submit" class="y-btn J_promo_submit"  style="width:100%">确认</a><a href="javascript:void(0)"  type="submit" class="y-btn J_un_promo_submit hide"  style="width:100%">正在处理</a></div><div class="height-box"></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/pages/promo",["zepto-wepp@~1.1.0","underscore@~1.5.0","marionette@~1.4.0","../modules/promo/content/controller","../modules/promo/layout.html"],function(e,t){var o=(e("zepto-wepp"),e("underscore")),i=e("marionette"),n=e("../modules/promo/content/controller"),r=i.Controller.extend({show:function(t){var i=this;i.contentController=new n({orderId:t}),ThisApp.openPage().then(function(t){t.initRegion({template:o.template(e("../modules/promo/layout.html")),regions:{header:".J_header",content:".J_cnt"}}),i.contentController.show(t.layout.content)})}});t.Controller=r},{asyncDeps:["iscroll@~5.0.9"]});
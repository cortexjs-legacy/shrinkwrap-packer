define("unit-m-weixin@1.12.6/js/modules/orderlist/list/controller",["backbone@~1.1.0","./template.html","underscore@~1.5.0","zepto-wepp@~1.1.0","marionette@~1.4.0","../../../entities/orderlist"],function(e,t,i){var o=e("backbone").View.extend({template:e("./template.html"),tagName:"ul"}),n=e("underscore"),s=e("zepto-wepp"),r=e("marionette"),l=e("../../../entities/orderlist");i.exports=r.Controller.extend({initialize:function(e){function t(){c=d.region.$el.get(0).offsetHeight}var i=e.page;e.start=e.start||0,delete e.page,this.paramModel=new l.OrderModel(e),this.collection=new l.OrderCollection(this.paramModel);var r=this.collection;r.clearCache();var a=this.view=new o({collection:this.collection}),d=this;r.on("reset",n.bind(function(){if(this.region.ensureEl(),!r.models.length)return 0==this.paramModel.get("start")&&this.region.$el.html('<p style="background-color:#f8f8f8;padding:12px 0px;text-align:center;text-indent: -12px;">您没有已付款的订单</p>'),void this.hideLoading();var e="";r.toJSON().forEach(function(t){e+=n.template(a.template,t)}),a.$el.append(e),this.region.$el.empty().append(a.$el),t()},this)),this.listenToNext();var c=0,h=s(window);h.on("scroll",function(){ThisApp.pageRegion.isCurrentPage(i)&&h.scrollTop()+h.height()>c-60&&(console.log("more"),d.more())})},show:function(e){this.region=e},isEnd:function(){return this._isEnd},next:function(){return this._next},listenToNext:function(){var e=this;this.collection.on("sync",n.bind(function(t,i){e._isEnd=i.data.isEnd,e._next=i.data.nextStartIndex,e.isEnd()&&this.hideLoading()},this))},more:function(){if(!this._isEnd){this.showLoading();var e=this.collection.paramModel;e.set({start:this.next()})}},showLoading:function(){s(".J_orderlist_more_loading").removeClass("hide")},hideLoading:function(){s(".J_orderlist_more_loading").addClass("hide")},toggleLoading:function(){return this.isEnd()?(this.hideLoading(),!0):(this.showLoading(),!1)}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/orderlist/layout.html",[],function(e,t,i){i.exports='<div class="J_order_list order-list-hack itemlist"></div><div class="more-loading J_orderlist_more_loading" style="visibility: visible;">正在加载...</div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/modules/orderlist/list/template.html",[],function(e,t,i){i.exports='<a href="#orderdetail~<%=id%>" class="item"><img src="<%=photo%>"/><div class="content"><h3><%=title%></h3><div class="count"><span class="price">¥<%=priceStr%></span><span class="status"><%=statusMemo%></span></div></div></a>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/entities/orderlist",["backbone@~1.1.0","underscore@~1.5.0"],function(e,t){var i=e("backbone"),o=window.localStorage,n=i.Model.extend({}),s=e("underscore"),r=i.Collection.extend({initialize:function(e){this.paramModel=e,this.paramModel.on("change",s.bind(this.showList,this)),this.paramModel.trigger("change")},model:n,baseUrl:"/ajax/tuan/orderlistgn.json?",setUrl:function(){this.url=this.baseUrl+"start="+(this.paramModel.get("start")||0)+"&filter="+this.paramModel.get("type")+"&r="+Math.random()},parse:function(e){if(200==e.code){this.type=this.paramModel.get("type");var t,i=this,n=e.data.list,s=(n?n:[]).map(function(e){var t={count:e.count,id:e.id,photo:e.photo,status:e.status,priceStr:e.priceStr,title:e.title,statusMemo:e.statusMemo};return i.collectionArr.push(t),t});try{t=JSON.parse(o.getItem("orderCollection"))||[]}catch(r){t=[]}return o.setItem("orderCollection",JSON.stringify(t.concat(this.collectionArr))),s}401==e.code},showList:function(){this.collectionArr=[],this.setUrl(),this.fetch({reset:!0})},clearCache:function(){o.removeItem("orderCollection")}}),n=i.Model.extend();t.OrderCollection=r,t.OrderModel=n},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@1.12.6/js/pages/orderlist",["zepto-wepp@~1.1.0","underscore@~1.5.0","marionette@~1.4.0","../modules/orderlist/list/controller","../modules/orderlist/layout.html"],function(e,t){var i=(e("zepto-wepp"),e("underscore")),o=e("marionette"),n=e("../modules/orderlist/list/controller"),s=o.Controller.extend({show:function(){ThisApp.openPage().then(function(t){t.initRegion({template:i.template(e("../modules/orderlist/layout.html")),regions:{header:"header",list:".J_order_list"}});var o=new n({type:2,page:t});o.show(t.layout.list)})}});t.Controller=s},{asyncDeps:["iscroll@~5.0.9"]});
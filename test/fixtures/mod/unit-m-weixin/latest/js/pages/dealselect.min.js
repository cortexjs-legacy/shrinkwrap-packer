define("unit-m-weixin@latest/js/modules/dealselect/content/controller",["wepp@~2.7.0","../../../util/cache","backbone@~1.1.0","../../../entities/detail","./template.html"],function(e,t,i){var n=e("wepp"),s=e("../../../util/cache"),r=e("backbone").Model.extend();i.exports=n.Module.BaseController.extend({initModel:function(t){var i=s.get("DealCache");if(i&&i.id===t.groupId){var a=new r(i);return a.fetch=function(){setTimeout(function(){a.set("r",1)})},a}return new(e("../../../entities/detail"))({id:t.groupId,cityid:n.Module.City.getId()})},initTpl:function(){return e("./template.html")}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/dealselect/layout.html",[],function(e,t,i){i.exports='<div class="J_cnt"><div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/util/cache",[],function(e,t,i){function n(e){return e in r?r[e]:null}function s(e){return a?JSON.parse(localStorage.getItem(e)):null}var r={},a="localStorage"in window&&null!==window.localStorage,l={has:function(e){return e in r||a&&null!==localStorage.getItem(e)},get:function(e){return null!==n(e)?n(e):s(e)},set:function(e,t){r[e]=t,a&&localStorage.setItem(e,JSON.stringify(t))},remove:function(e){delete r[e],a&&localStorage.removeItem(e)}};i.exports=l},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/entities/detail",["backbone@~1.1.0","../base/weixin","wepp@~2.7.0","./dealstatus"],function(e,t,i){var n=e("backbone"),s=e("../base/weixin"),r=e("wepp").ENV,a=e("./dealstatus");i.exports=n.Model.extend({initialize:function(e){this.param=e,this.setUrl(),this.fetch()},baseUrl:"/ajax/tuan/dealgn.json?",setUrl:function(){this.url=this.baseUrl+"id="+this.param.id+"&cityid="+this.param.cityid+(window.HIPPO_DATA&&window.HIPPO_DATA.request_id?"&rid="+window.HIPPO_DATA.request_id:"")},parse:function(e){var t=e.data;t.price=-1!==t.price.toString().indexOf(".")?(+t.price).toFixed(2):t.price,t.status=this.getDealStatus(t.status),t.time=this.getTime(t,t.status),t.yuyue=1===t.tag;var i,n,a,l=t.dealSelects;if(a=i=1==l.length?"#order~g_"+t.id+"~d_"+l[0].id:"#dealselect~g_"+t.id,s.isInWeixin()&&!ThisApp.isLogin?(i=encodeURIComponent(location.href.replace(/#[\w\W]+/,"")+i),n="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+r.get("appid")+"&redirect_uri="+r.get("cpsUrl")+"/weiXinRedirect&response_type=code&scope=snsapi_base&state="+i+"#wechat_redirect"):n=i,t.nextUrl=n,t.originGoToUrl=a,t.extra=(t.extra||[]).map(function(e){return{title:e.id,cont:e.name.replace(/\n/g,"<br/>"),red:4==e.type}}),t.shopNum=t.shopIdsStr?t.shopIdsStr.split(",").length:0,this.param.selectId){var o=this;t.selectDeal=(t.dealSelects.filter(function(e){return e.id==o.param.selectId})||[])[0]}return t.count=t.buyMixCount,t},getDealStatus:function(e){return a.isSellOut(e)?1:a.isEnd(e)?2:a.isCantBuy(e)?3:a.isToBegin(e)?4:0},getTime:function(e,t){var i;if(1==t||2==t||4==t){var n=new Date(e.time);i=n.getFullYear()+"年"+(n.getMonth()+1)+"月"+n.getDate()+"日",i=4==t?"开始于"+i+n.getHours()+":"+n.getMinutes():"结束于"+i}else{var s=e.time-(new Date).getTime(),r=s/864e5;if(r>=3)i="剩余3天以上";else if(r>=1&&3>r)i="剩余"+parseInt(r)+"天";else{var a=parseInt(r),l=parseInt(s/36e5-24*a),o=parseInt(s/6e4-1440*a-60*l);i="剩余"+(a>0?a+"天":"")+l+"小时"+o+"分"}}return i}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/dealselect/content/template.html",[],function(e,t,i){i.exports='<p class="c-box-tit">请选择套餐</p><div class="c-box dealselect"><%dealSelects.forEach(function(item){if(item.status == 1){%><a class="item mult" style="padding-right:100px;" href="#order~g_<%=id %>~d_<%=item.id%>" onclick="ThisApp.mv({module:\'order_choice\'})"><%= item.title %><span class="arrow-txt">￥<%=item.priceStr%></span><i class="arrow-ent"></i></a><% }else if(item.status == 2){ %><div class="item mult"><span class="Orange">[已卖光]</span><%=item.title %></div><% }}); %></div><div class="height-box"></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/base/weixin",[],function(e,t){var i=navigator.userAgent;t.isInWeixin=function(){return/MicroMessenger/.test(i)},t.version=function(){var e=i.match(/MicroMessenger\/(\d+\.\d+)/);try{return e?Number(e[1])||0:0}catch(t){return 0}}},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/entities/dealstatus",[],function(e,t,i){var n={getStr:function(e){return e.toString(2).split("").reverse().join("")},isNew:function(e){var t=this.getStr(e);return parseInt(t[0])},isSellOut:function(e){var t=this.getStr(e);return parseInt(t[1])},isEnd:function(e){var t=this.getStr(e);return parseInt(t[2])},isCantBuy:function(e){var t=this.getStr(e);return parseInt(t[3])},isToBegin:function(e){var t=this.getStr(e);return parseInt(t[4])},isNormal:function(e){var t=this.getStr(e);return parseInt(t[5])}};i.exports=n},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/pages/dealselect",["zepto-wepp@~1.1.0","underscore@~1.5.0","wepp@~2.7.0","../modules/dealselect/content/controller","../modules/dealselect/layout.html"],function(e,t){var i=(e("zepto-wepp"),e("underscore")),n=e("wepp"),s=e("../modules/dealselect/content/controller");t.Controller=n.PageController.extend({show:function(t){ThisApp.openPage().then(function(n){n.initRegion({template:i.template(e("../modules/dealselect/layout.html")),regions:{header:".J_header",content:".J_cnt"}}),new s({groupId:t}).render(n.layout.content)})}})},{asyncDeps:["iscroll@~5.0.9"]});
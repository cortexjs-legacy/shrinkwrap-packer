define("unit-m-weixin@latest/js/util/distance",[],function(e,t,i){var n=Math.PI,s=6371e3;i.exports=function(e,t){var i,a=e.lat/180*n,o=e.lng/180*n,r=t.lat/180*n,l=t.lng/180*n,c=r-a,d=l-o,h=Math.sin(c/2)*Math.sin(c/2)+Math.cos(a)*Math.cos(r)*Math.sin(d/2)*Math.sin(d/2),u=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),m=s*u;if(100>m)i="<100m";else if(m>=100&&1e3>m)i=10*Math.round(m/10)+"m";else if(m>=1e3&&1e5>m){var p=(m/1e3).toFixed(1);i=("0"===p.charAt(p.length-1)?parseInt(p):p)+"km"}else i=">100km";return{distance:m,distanceText:i}}},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/common/first",["wepp@~2.7.0"],function(e,t,i){var n=e("wepp").Url;i.exports={firstVisit:function(){return null===localStorage.getItem("cityselect")},firstSelect:function(){return"first"===localStorage.getItem("cityselect")},checkFirst:function(){var e=n.get("cityid");return!e&&this.firstVisit()?(localStorage.setItem("cityrefer",location.hash),ThisApp.redirect("#citylist",!0),!0):!1}}},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/index/layout.html",[],function(e,t,i){i.exports='<div class="nav"><div class="search_holder Fix"></div><div class="J_nav"><div class="cat"><div class="item">全部分类<i class="drop"></i></div><div class="item">全部商区<i class="drop"></i></div><div class="item last">默认排序<i class="drop"></i></div></div></div></div><div class="indexlist"><div class="J_list"></div><div class="more-loading" style=\'visibility:hidden;\'>正在加载...</div></div><div class="height-box"></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/common/deallist/controller",["marionette@~1.4.0","backbone@~1.1.0","./template.html","underscore@~1.5.0","../../../entities/deallist"],function(e,t,i){var n=e("marionette"),s=e("backbone").View.extend({template:e("./template.html"),className:"deallist"}),a=e("underscore"),o=e("../../../entities/deallist").ListCollection,r=e("../../../entities/deallist").ParamModel;i.exports=n.Controller.extend({initialize:function(e){this.paramModel=new r(e),this.collection=new o(this.paramModel),this.resetHtml=!0},getView:function(){return this.view||(this.view=new s({collection:this.collection}),this.trigger("getview",this.view)),this.view},show:function(e,t){this.region=e,this.paramModel.set(t||{})},listenReset:function(){this.collection.on("reset",a.bind(function(){this.render(),this.region.ensureEl(),this.region.$el.empty().append(this.getView().$el),this.trigger("rendered",this.resetHtml)},this))},render:function(){var e=this.getView(),t="";if(this.collection.toJSON().forEach(function(i){t+=a.template(e.template,i)}),this.resetHtml&&""===t){var i;t=(i=this.paramModel.get("keyword"))?'<p style="line-height:40px;text-align:center;">没有找到<span style="color:#ff8800;">'+i+"</span>相关团购,换个关键字试试吧!</p>":'<p style="line-height:40px;text-align:center;">没有相关团购</p>'}e.$el[this.resetHtml?"html":"append"](t)}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/common/alert/controller",["wepp@~2.7.0","./template.html","backbone@~1.1.0","marionette@~1.4.0","underscore@~1.5.0","zepto-wepp@~1.1.0"],function(e,t,i){var n=e("wepp").Module.BaseView(e("./template.html")),s=e("backbone"),a=e("marionette"),o=(e("underscore"),e("zepto-wepp"));i.exports=a.Controller.extend({initialize:function(e){this.view=new n({model:new s.Model(e)}),this.view.render(),this.box=this.view.$el.hide().appendTo("body"),this.box.find(".alert_buttons a").each(function(t,i){e.buttons[t].click&&o(i).on("click",e.buttons[t].click)}),e.buttons&&1===e.buttons.length&&this.box.find(".alert_buttons a").css("width","100%")},show:function(){this.box.show();var e=this.box.find(".confirm_alert");e.css("margin-top",-e.height()/2)},hide:function(){this.box.hide()}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/entities/navlist",["backbone@~1.1.0","underscore@~1.5.0"],function(e,t,i){var n=e("backbone"),s=e("underscore");i.exports=n.Model.extend({_filter:function(e){return e},parse:function(e,t){var i={categoryList:[],regionList:[],filterList:[],currentCategory:"全部分类",currentFilter:"默认排序",currentRegion:"全部商区"};s.extend(i,t);"categoryenname"in i||(i.categoryenname=""),"parentcategoryenname"in i||(i.parentcategoryenname=""),"regionenname"in i||(i.regionenname=""),"parentregionenname"in i||(i.parentregionenname="");var n=e.data.categoryNavs||[];i.categoryList=n.filter(function(e){return 0==e.parentID&&e.id<3e4&&(e.count>0||"0"===e.enName)}),i.categoryList.forEach(function(e){e.id==i.categoryid&&(i.categoryenname=e.enName||"",i.parentcategoryenname=e.parentEnName||"",i.currentCategory=e.name,e.isSelected=!0),"0"!==e.enName&&(e.subList=n.filter(function(t){var n=t.count>0&&t.parentID===e.id;return n&&i.categoryid==t.id&&(i.categoryenname=t.enName||"",i.parentcategoryenname=t.parentEnName||"",i.currentCategory=t.name,t.isSelected=!0,e.isSelected=!0),n}))});var a=e.data.regionNavs||[];return i.regionList=a.filter(function(e){return 0==e.parentId&&(e.count>0||"0"===e.enName||"nearby"===e.enName)}),i.regionList.forEach(function(e){i.regionid==e.id&&(i.currentRegion=e.name,i.regionenname=e.enName||"",i.parentregionenname=e.parentEnName||"",e.isSelected=!0),"0"!==e.enName&&(e.subList=a.filter(function(t){var n=t.parentId==e.id&&(t.count>0||"nearby"===e.enName);return n&&i.regionid==t.id&&(i.currentRegion=t.name,i.regionenname=t.enName||"",i.parentregionenname=t.parentEnName||"",t.isSelected=!0,e.isSelected=!0),n}))}),i.filterList=e.data.filterNav||[],i.filterList.forEach(function(e){i.filter==e.id&&(i.currentFilter=e.name,e.isSelected=!0)}),i}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/base/share",["wepp@~2.7.0","underscore@~1.5.0","zepto-wepp@~1.1.0"],function(e,t,i){function n(){var e=o.link.match(/\?([^#$]*)/),t={};e&&(t=a.parse(e[1])),t.utm="wxshare";var i=o.link.replace(/(\?[^#$]*)/,"");o.link=i.replace(/((:?#[\w\W]*)|$)/,function(e,i){return"?"+a.stringify(t)+i}),console.log(o.link)}function s(){c||window.WeixinJSBridge&&(c=!0,WeixinJSBridge.on("menu:share:appmessage",function(){l&&(n(),WeixinJSBridge.invoke("sendAppMessage",o,function(){}))}),WeixinJSBridge.on("menu:share:timeline",function(){if(l){n();var e=r.clone(o);e.title=e.timelineTitle||e.title,WeixinJSBridge.invoke("shareTimeline",e,function(){})}}),e("zepto-wepp").os.ios&&WeixinJSBridge.call("hideToolbar"))}var a=e("wepp").Url,o={appid:"wx841a97238d9e17b2",img_url:"",img_width:"640",img_height:"640",link:"",desc:"",title:"",timelineTitle:""},r=e("underscore"),l=!1,c=!1;s(),document.addEventListener("WeixinJSBridgeReady",s,!1),i.exports={config:function(e){o=r.extend(o,e)},enable:function(e){l=e;try{c?WeixinJSBridge.call(l?"showOptionMenu":"hideOptionMenu"):l?document.addEventListener("WeixinJSBridgeReady",function(){WeixinJSBridge.call("showOptionMenu")},!1):document.addEventListener("WeixinJSBridgeReady",function(){WeixinJSBridge.call("hideOptionMenu")},!1)}catch(t){}},linkPre:n,__config__:o}},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/common/search/template.html",[],function(e,t,i){i.exports='<form action="" method="post"><%if(showCity){%><div class="city"><a href="#citylist" onclick="ThisApp.mv({module:\'index_city\'})" ><%=cityname%></a><i class="drop"></i></div><%}%><div class="search_inner <%=showCity?\'\':\'first\'%>"><input type="text" placeholder="商户名，地址等..." class="J_search_box search_box"/><a class="cancel J_cancel" href="javascript:;">取消</a><%if(showBack){%><a class="cancel J_back" href="javascript:history.go(-1);">返回</a><%}%><input type="submit" class="hide"></div></form><div class="J_history history"><div><ul><%history.forEach(function(item){%><li><%=item%></li><%});%></ul><a href="javascript:;" class="clear">清除搜索记录</a></div></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/common/alert/template.html",[],function(e,t,i){i.exports='<div class="overlay"></div><div class="confirm_alert"><div class="alert_content"><%=content%></div><div class="alert_buttons"><%buttons.forEach(function(btn){%><a href="<%=(btn.url||\'javascript:;\')%>"><%=btn.text%></a><%});%></div></div>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/common/deallist/template.html",[],function(e,t,i){i.exports='<a href="#detail~<%=id %>"><img src="<%= imageUrl %>" class="img"><h3><%= contentTitle %></h3><div class="price"><span class="price-c">&#165;<%= price %></span><span class="price-o">&#165;<%= originalPrice %></span><span class="distance"><%=distance%></span></div><div class="count"><span class="num"><%= buyerCounter %>人</span><span class="place"><%=regionPrefix %></span></div><div class="<%=jb%>"></div></a>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/common/search/controller",["marionette@~1.4.0","wepp@~2.7.0","./template.html","zepto-wepp@~1.1.0","underscore@~1.5.0","backbone@~1.1.0"],function(e,t,i){function n(){var e=d.getName()||"";return e.length>3?e.substr(0,2)+"..":e}var s=e("marionette"),a=e("wepp").Module,o=a.BaseView(e("./template.html")),r=e("zepto-wepp"),l=e("underscore"),c=e("backbone"),d=a.City,h=s.Controller.extend({initialize:function(e){var t={showCity:!0,showBack:!1};this.options=l.extend(t,e||{}),this.view=new o({model:new c.Model({history:h.History.get(),cityname:n(),showCity:this.options.showCity,showBack:this.options.showBack})})},show:function(e,t){e.show(this.view);var i=this.view.$el;this.searchBox=i.find(".J_search_box"),this.cancelBtn=i.find(".J_cancel"),this.backBtn=i.find(".J_back"),this.historyHolder=i.find(".J_history"),this.historyList=i.find(".J_history ul"),this.clearBtn=i.find(".J_history .clear"),this.cityBox=i.find(".city"),this.trigger("show"),t&&this.setKeywords(t),this.bindEvents()},search:function(e){h.History.add(e),this.searchBox.val(e),this.trigger("search",e)},cancel:function(){var e=this;this.searchBox.parent().removeClass("float"),this.cityBox.removeClass("float"),this.searchBox.get(0).blur(),this.backBtn.show().addClass("on"),this.cancelBtn.hide(),setTimeout(function(){e.historyHolder.hide()},400),this.trigger("blur")},setKeywords:function(e){this.view.$el.find(".J_search_box").val(e)},bindEvents:function(){var e=this,t=this.view.$el;t.find("form").on("submit",l.bind(this.submit,this)),this.searchBox.on("focus",function(){e.onFocus()}),this.searchBox.on("touchstart",function(){e.trigger("touch")}),this.searchBox.on("blur",function(){e.cancel()}),this.cancelBtn.on("click",function(){e.cancel()}),this.historyList.on("click","li",function(t){e.cancel(),e.search(t.currentTarget.innerText)}),h.History.on("add",function(t){e.append(t)}),h.History.on("pop",function(){var t=e.historyList.children();t.eq(t.length-1).remove()}),h.History.on("clear",function(){e.historyList.empty()}),this.clearBtn.on("click",function(){h.History.clear(),e.refresh()}),d.on("change",function(){e.view.$el.find(".city a").html(n())})},submit:function(e){e.preventDefault();var t=this.searchBox.val();this.cancel(),t&&this.search(t)},append:function(e){this.historyList.prepend("<li>"+e+"</li>"),this.refresh()},showHistory:function(){this.historyHolder.show().css("height",r(window).height()-40),this.refresh()},initIscroll:function(){var t=this;e.async("iscroll",function(e){t.scroll=new e(t.historyHolder.get(0),{mouseWheel:!0,click:!0})})},refresh:function(){this.scroll?this.scroll.refresh():this.initIscroll()},onFocus:function(){this.searchBox.parent().addClass("float"),this.cityBox.addClass("float"),this.showCancel(),this.showHistory(),this.trigger("focus")},showBack:function(){this.backBtn.show().addClass("on"),this.cancelBtn.hide()},showCancel:function(){this.backBtn.hide(),this.cancelBtn.show()}});h.History={KEY:"search_history",get:function(){var e=window.localStorage.getItem(this.KEY);return e?e.split(","):[]},add:function(e){var t=this.get();-1===t.indexOf(e)&&(t.unshift(e),t.length>20&&(t.pop(),this.trigger("pop")),window.localStorage.setItem(this.KEY,t.join(",")),this.trigger("add",e))},clear:function(){window.localStorage.removeItem(this.KEY),this.trigger("clear")}},l.extend(h.History,c.Events),i.exports=h},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/entities/deallist",["./dealstatus","backbone@~1.1.0","underscore@~1.5.0","wepp@~2.7.0","../util/distance"],function(e,t){var i=e("./dealstatus"),n=e("backbone"),s=e("underscore"),a=e("wepp").Module.City,o=e("../util/distance"),r=n.Collection.extend({model:n.Model.extend({}),fetchingMore:!1,fetching:!1,hasResult:!0,initialize:function(e){this.paramModel=e,this.url=this.paramModel.getUrl(),this.behaviorModel=new c,this.paramModel.on("change",s.bind(this.research,this)),this.on("sync",s.bind(function(){this.fetching=!1,this.fetchingMore=!1},this))},parse:function(e){var t=this.paramModel;return e.data.city&&a.set({id:e.data.city.id,enname:e.data.city.enName,name:e.data.city.name}),(e.data.list||[]).map(function(e){var n=e.status,s=e.tag;return e.jb=i.isNew(n)?"xindan":i.isSellOut(n)?"maiguang":i.isEnd(n)?"jieshu":i.isToBegin(n)?"jijiangkaishi":i.isNormal(n)&&1==s?"yuyue":"",e.distance=e.lat&&e.lng&&t.get("lat")&&t.get("lng")?o({lat:e.lat,lng:e.lng},{lat:t.get("lat"),lng:t.get("lng")}).distanceText:null,e})},research:function(){this.url=this.paramModel.getUrl(),this.fetching||(this.fetching=!0,this.fetchXhr=this.fetch(this.behaviorModel.attributes))},cancel:function(){this.fetchXhr&&this.fetchXhr.abort(),this.fetching=!1,this.fetchingMore=!1}}),l=n.Model.extend({defaults:{baseUrl:""},parseParam:function(){var e=[];return s.each(this.attributes,function(t,i){"baseUrl"!==i&&void 0!==t&&e.push(i+"="+(null===t?"":encodeURIComponent(t)))}),e.push("from=weixin"),e.join("&")},getUrl:function(){return this.get("baseUrl")+"?"+this.parseParam()}}),c=n.Model.extend({defaults:{reset:!0,remove:!1}});t.ListCollection=r,t.ParamModel=l},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/index/filter/controller",["marionette@~1.4.0","underscore@~1.5.0","zepto-wepp@~1.1.0","wepp@~2.7.0","./template.html","../../../entities/navlist","../../../base/share"],function(e,t,i){{var n=e("marionette"),s=e("underscore"),a=e("zepto-wepp"),o=e("wepp"),r=o.Module.BaseView(e("./template.html")),l=(o.Module.City,e("../../../entities/navlist")),c=e("../../../base/share");i.exports=n.Controller.extend({initialize:function(e){this.listCollection=e.collection,this.paramModel=e.paramModel,this.region=e.region,this.page=e.page,this.model=new l;var t=this;this.listCollection.on("sync",s.bind(function(e,t){var i=this.paramModel.get("start");if("0"==i&&""==i){if(0==e.length&&this.paramModel.get("keyword"))this.region.ensureEl(),this.region.$el.hide();else{var n=this.model.parse(t,this.paramModel.attributes);this.model.set(n),this.render(this.region),this.region.$el.show()}c.config({img_url:e.models.length?e.models[0].get("imageUrl"):"",link:location.href})}},this)),this.overlay=new ThisApp.Overlay(this.page.el),this.overlay.on("hide",function(){t.view&&t.view.$el.find(".selector").addClass("hide"),t.view&&t.view.$el.find(".J_nt").removeClass("on")}),this.unlock(),this.page.on("reshow",function(){e.page.el.css("-webkit-transform","none")}),this.page.on("show",function(){e.page.el.css("-webkit-transform","none")})},render:function(t){function i(e){e.preventDefault(),e.stopPropagation()}var n=this.view=new r({model:this.model});t.show(n),this.show=function(){n.$el.show()},this.hide=function(){n.$el.hide()},this.page.el.css("-webkit-transform","none");var s=n.$el,o=s.find(".selector"),l=this;e.async("iscroll",function(e){o.each(function(t,i){var n=a(i),s=a(n.find(".J_ml").concat(n.find(".J_sl").get()));n.removeClass("hide"),s.each(function(t,i){var n=a(i),s=n.hasClass("hide");n.removeClass("hide"),i._scroll_=new e(n.get(0),{mouseWheel:!0,click:!0,scrollbars:!0}),s&&n.addClass("hide")}),n.addClass("hide")}),s.parents(".nav").css("position","fixed")}),s.find(".J_nt").on("touchstart",function(e){if(i(e),!l._lock){l.lock();var t=a(this);s.find(".J_nt").removeClass("on");var n=t.addClass("on").data("listclass"),r=s.find("."+n),c=r.hasClass("hide")?"removeClass":"addClass",d=r.hasClass("hide")?"show":"hide";"addClass"===c?setTimeout(function(){o.addClass("hide"),r[c]("hide"),l.overlay[d]()},400):(o.addClass("hide"),r[c]("hide"),l.refresh(),l.overlay[d]()),setTimeout(function(){l.unlock()},500)}}),s.find(".J_mainlistitem").on("click",function(e){if(i(e),!l._lock){l.lock();var t=a(this),n=t.closest(".selector");n.find(".J_ml .on").removeClass("on"),a(this.parentNode).addClass("on");var s=t.data("id"),o=t.data("pid"),r=t.data("name"),c=t.data("en"),d=t.data("pen");n.find(".J_sl").addClass("hide").forEach(function(e){var t=a(e);t.data("pid")==s&&(t.removeClass("hide"),e._scroll_&&e._scroll_.refresh())});var h=n.attr("ref"),u=a("#"+h).html(r+'<i class="drop"></i>');u.data("id",s),u.data("pid",o),u.data("en",c),u.data("pen",d),setTimeout(function(){l.unlock()},500)}}),s.find(".J_list_link").on("click",function(e){if(i(e),!l._lock){l.lock();var t=a(this);s.find(".J_nt").removeClass("on");var n=t.data("id"),r=(t.data("pid"),t.data("name")),c=t.data("en"),d=t.data("pen"),h=t.closest("section").attr("ref"),u=a("#"+h).html(r+'<i class="drop"></i>');u.data("id",n),u.data("pid",n),u.data("en",c),u.data("pen",d),l._updateList(),setTimeout(function(){o.addClass("hide"),l.overlay.hide(),l.unlock()},350)}})},_updateList:function(){var e=a("#J_c_c"),t=a("#J_c_r"),i=a("#J_c_f"),n={categoryid:e.data("id"),parentcategoryid:e.data("pid"),categoryenname:e.data("en"),parentcategoryenname:e.data("pen"),regionid:t.data("id"),parentregionid:t.data("pid"),regionenname:t.data("en"),parentregionenname:t.data("pen"),filter:i.data("id"),start:0};ThisApp.vent.trigger("select:channel",n)},lock:function(){this._lock=!0},unlock:function(){this._lock=!1},refresh:function(){var e=this.view.$el.find(".selector");e.each(function(e,t){if(!a(t).hasClass("hide")){var i=a(a(t).find(".J_ml").concat(a(t).find(".J_sl").get()));i.each(function(e,t){var i=a(t);!i.hasClass("hide")&&t._scroll_&&t._scroll_.refresh()})}})},hide:function(){},show:function(){}})}},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/entities/dealstatus",[],function(e,t,i){var n={getStr:function(e){return e.toString(2).split("").reverse().join("")},isNew:function(e){var t=this.getStr(e);return parseInt(t[0])},isSellOut:function(e){var t=this.getStr(e);return parseInt(t[1])},isEnd:function(e){var t=this.getStr(e);return parseInt(t[2])},isCantBuy:function(e){var t=this.getStr(e);return parseInt(t[3])},isToBegin:function(e){var t=this.getStr(e);return parseInt(t[4])},isNormal:function(e){var t=this.getStr(e);return parseInt(t[5])}};i.exports=n},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/index/list/controller",["../../common/deallist/controller","wepp@~2.7.0","underscore@~1.5.0"],function(e,t,i){var n=e("../../common/deallist/controller"),s=(e("wepp").UI,e("underscore"));i.exports=n.extend({showLoad:function(){this.view.$el.parent().next().css("visibility","visible")},hideLoad:function(){this.view.$el.parent().next().css("visibility","hidden")},isEnd:function(){return this._isEnd},next:function(){return this._next},listenToNext:function(){this.collection.on("sync",s.bind(function(e,t){this._isEnd=t.data.isEnd,this._next=t.data.nextStartIndex,t.data.isEnd&&this.hideLoad()},this))},more:function(){if(this.isEnd())return void this.hideLoad();this.showLoad();var e=this.collection.paramModel;this.resetHtml=!1,e.set({start:this.next()})},hidden:function(){this.view&&this.view.$el.hide()},removeHidden:function(){this.view&&this.view.$el.show()}})},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/modules/index/filter/template.html",[],function(e,t,i){i.exports='<div class="cat"><div onclick="ThisApp.mv({module:\'list_categroy\'})" class="item J_nt" data-en="<%=categoryenname%>" data-pen="<%=parentcategoryenname%>" data-id="<%=categoryid%>" data-listclass="J_c_l" id="J_c_c"><%=currentCategory%><i class="drop"></i></div><div onclick="ThisApp.mv({module:\'list_distict\'})" class="item J_nt" data-en="<%=regionenname%>" data-pen="<%=parentregionenname%>" data-id="<%=regionid%>"  data-listclass="J_r_l" id="J_c_r"><%=currentRegion%><i class="drop"></i></div><div onclick="ThisApp.mv({module:\'list_sort\'})" class="item last J_nt" data-id="<%=filter%>" data-listclass="J_f_l" id="J_c_f"><%=currentFilter%><i class="drop"></i></div></div><section class="selector hide Fix J_c_l" ref="J_c_c"><div class="main J_ml"><ul><%_.each(categoryList,function(item){%><li <%if(item.isSelected){%>class="on"<%}%>><%if(item.subList && item.subList.length){%><p class="J_mainlistitem" data-id="<%=item.id%>" data-pid="<%=item.parentID%>" data-pen="<%=item.parentEnName%>" data-en="<%=item.enName%>" data-name="<%=(item.realName||item.name)%>"><%=item.name%><span class="num"><%= (item.count?item.count:"") %></span></p><%}else{%><a class="J_list_link Fix" data-en="<%=item.enName%>" data-pen="<%=item.parentEnName%>" data-cat="Category" data-id="<%=item.id%>" data-pid="<%=item.parentID%>" data-name="<%=item.realName||item.name%>" href="javascript:;"><%=item.name%><span class="num"><%=item.count?item.count:""%></span></a><%}%></li><%});%></ul></div><%_.each(categoryList,function(item){%><%if(item.subList && item.subList.length){%><div class="sub <%if(!item.isSelected){%>hide<%}%> J_sl" data-pid="<%=item.id%>"><ul><% _.each(item.subList,function(sub){%><li <%if(sub.isSelected){%>class="on"<%}%>><a class="J_list_link Fix" data-cat="Category" data-en="<%=sub.enName%>" data-pen="<%=sub.parentEnName%>" data-id="<%=sub.id%>" data-pid="<%=sub.parentID%>" data-name="<%=(sub.realName||sub.name)%>" href="#"><%=sub.name%><span class="num"><%=sub.count?sub.count:""%></span></a></li><%});%></ul></div><%}%><%});%></section><section class="selector hide Fix J_r_l" ref="J_c_r"><div class="main J_ml"><ul><%_.each(regionList,function(item){%><li <%if(item.isSelected){%>class="on"<%}%>><%if(item.subList && item.subList.length){%><p class="J_mainlistitem" data-id="<%=item.id%>" data-pid="<%=item.parentId%>" data-pen="<%=item.parentEnName%>" data-en="<%=item.enName%>" data-name="<%=item.realName||item.name%>"><%=item.name%><span class="num"><%=item.count?item.count:""%></span></p><%}else{%><a class="J_list_link Fix" data-cat="Region" data-en="<%=item.enName%>" data-pen="<%=item.parentEnName%>"  data-id="<%=item.id%>" data-pid="<%=item.parentId%>" data-name="<%=item.realName||item.name%>" href="#"><%=item.name%><span class="num"><%=item.count?item.count:""%></span></a><%}%></li><%});%></ul></div><%_.each(regionList,function(item){%><%if(item.subList && item.subList.length){%><div class="sub <%if(!item.isSelected){%>hide<%}%> J_sl" data-pid="<%=item.id%>"><ul><% _.each(item.subList,function(sub){%><li <%if(sub.isSelected){%>class="on"<%}%>><a class="J_list_link Fix" data-cat="Category" data-en="<%=sub.enName%>" data-pen="<%=sub.parentEnName%>" data-id="<%=sub.id%>" data-name="<%=sub.realName||sub.name%>" href="#"><%=sub.name%><span class="num"><%=sub.count?sub.count:""%></span></a></li><%});%></ul></div><%}%><%});%></section><section class="selector hide J_f_l" ref="J_c_f"><div class="main full J_ml"><ul><%_.each(filterList,function(item){%><li <%if(item.isSelected){%>class="on"<%}%>><a class="J_list_link Fix" data-cat="Filter" data-id="<%=item.id%>" data-name="<%=item.name%>" href="#"><%=item.name%><span class="num"><%=item.count%></span></a></li><%});%></ul></div></section>'},{asyncDeps:["iscroll@~5.0.9"]}),define("unit-m-weixin@latest/js/pages/index",["zepto-wepp@~1.1.0","underscore@~1.5.0","wepp@~2.7.0","backbone@~1.1.0","cookie@~0.1.0","../modules/index/list/controller","../modules/index/filter/controller","../modules/common/search/controller","../modules/common/alert/controller","../modules/common/first","../modules/index/layout.html"],function(e,t){var i=e("zepto-wepp"),n=e("underscore"),s=e("wepp"),a=(e("backbone"),e("cookie"),e("../modules/index/list/controller")),o=e("../modules/index/filter/controller"),r=e("../modules/common/search/controller"),l=s.Module.City,c=s.Url,d=s.UI,h=i(window),u=!1,m=e("../modules/common/alert/controller"),p=e("../modules/common/first");t.Controller=s.PageController.extend({initialize:function(){this.page=null,this.inited=!1},show:function(e,t,i,s,a,o){this.firstSelect=p.firstSelect();var r=this,h=!1,u=c.parse(location.hash,"~");if(n.each(u,function(n,r){var l=r.split("_");switch(l[0]){case"c":t=l[1];break;case"k":e=l[1];break;case"r":i=l[1];break;case"f":s=l[1];break;case"lng":a=l[1];break;case"lat":o=l[1]}}),"search"===e&&null===t&&null===i&&null===s&&null===a&&null===o&&(h=!0),"2"==s&&(this.needMenu=!0,this.showMenu()),c.get("lng")&&(a=c.get("lng"),o=c.get("lat"),s="2"),"2"==s&&!a){s="1";var m=ThisApp.Geo.cookieGeo();m&&m.cityid===l.getId()?(o=m.lat,a=m.lng,s="1"):this.geolocation(e,t,i,1,a,o)}"2"==s&&(s="1");var f={keyword:e?decodeURIComponent(e):"",categoryid:t||0,regionenname:i||"0",parentregionenname:"0",regionid:"",filter:s||"1",lng:a||"",lat:o||"",r:+new Date};o&&a&&(f.cityid=null,f.regionenname="32758",f.parentregionenname="32755",f.regionid="32758"),ThisApp.openPage(!0).then(function(e){d.loading.show(),r.page=e,r.start(),r.navController.region=e.layout.nav,r.lc.listenReset(),h?(d.loading.hide(),r.lc.region=e.layout.list):r.lc.show(e.layout.list,f),f.keyword&&(h&&(f.keyword=""),r.sc.show(e.layout.search,f.keyword),e.layout.$el.find(".indexlist").addClass("hassearch"),h&&r.sc.onFocus()),r.trigger("index:start"),r.started=!0,e.on("reshow",function(){r.showMenu()})},function(){})},region:function(){this.page.initRegion({template:n.template(e("../modules/index/layout.html")),regions:{search:".search_holder",nav:".J_nav",list:".J_list"}})},start:function(){function e(){i=n.offsetHeight}var t=this;this.region(),this.lc=new a({baseUrl:"/ajax/tuan/searchdealgn.json",cityid:l.getId(),categoryid:"",regionenname:"0",parentregionenname:"0",regionid:"",keyword:"",filter:"",start:0});var i=0,n=this.page.layout.$el.find(".J_list").get(0),s=!1;this.navController=new o({collection:this.lc.collection,paramModel:this.lc.paramModel,region:this.page.layout.nav,page:this.page}),this.lc.listenToNext(),this.lc.on("rendered",function(){d.loading.hide(),e(),s||(s=!0,h.on("scroll",function(){ThisApp.pageRegion.isCurrentPage(t.page)&&h.scrollTop()+h.height()>i-30&&t.lc.more()}))}),this.initSearch(),this.inited||ThisApp.vent.on("select:channel",function(e){t.rerender(e)}),this.inited=!0},rerender:function(e){var t=this;t.lc.collection.cancel(),t.lc.resetHtml=!0,e.r=+new Date,t.lc.paramModel.set(e),d.loading.show()},geolocation:function(e,t,i,n){if(!u){u=!0;var s=this;ThisApp.Geo.get(!0).then(function(i){function a(){s.rerender({categoryid:t||0,regionenname:"32758",parentregionenname:"32755",regionid:"32758",keyword:e?decodeURIComponent(e):"",filter:n,cityid:null,lng:o,lat:r,r:+new Date})}var o=i.lng,r=i.lat,c=i.cityid==l.getId();if(c)s.started?a():s.on("index:start",a);else if(!s.firstSelect&&s.page&&ThisApp.pageRegion.isCurrentPage(s.page)){var h=new m({content:"系统定位到您在"+i.cityname+",是否切换?",buttons:[{text:"取消",click:function(){h.hide()}},{text:"切换",click:function(){h.hide(),a()}}]});d.loading.hide(),h.show()}},function(){!s.firstSelect&&s.page&&ThisApp.pageRegion.isCurrentPage(s.page)&&d.alert("获取定位信息失败,您可以手动设置您所在的城市",3e3)})}},initSearch:function(){var e=this,t=e.sc=new r({showCity:!1});t.on("touch",function(){e.hideMenu(),e.navController.hide(),e.lc.hidden()}),t.on("focus",function(){e.hideMenu(),e.navController.hide(),e.lc.hidden()}),t.on("blur",function(){e.navController.show(),e.lc.removeHidden(),e.showMenu()}),t.on("search",function(t){var i=e.lc.paramModel.toJSON();i.keyword=t,e.rerender(i)})},showMenu:function(){this.needMenu&&(ThisApp.Menu.show(),ThisApp.Menu.show().switchTo(1))},hideMenu:function(){ThisApp.Menu.hide()}})},{asyncDeps:["iscroll@~5.0.9"]});